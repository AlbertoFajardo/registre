<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>es.caib.regweb</groupId>
  <artifactId>ear</artifactId>
  <packaging>ear</packaging>
  <version>1.0</version>
  <name>Registre Web - ear</name>

  <parent>
    <groupId>es.caib</groupId>
    <artifactId>regweb</artifactId>
    <version>1.0</version>
  </parent>

  <dependencies>
    <dependency>
      <groupId>es.caib.regweb</groupId>
      <artifactId>webapp</artifactId>
      <version>1.0</version>
      <type>war</type>
    </dependency>

    <dependency>
      <groupId>es.caib.regweb</groupId>
      <artifactId>ejb</artifactId>
      <version>1.0</version>
      <type>ejb</type>
    </dependency>

    <dependency>
      <groupId>es.caib.regweb</groupId>
      <artifactId>logic</artifactId>
      <version>1.0</version>
      <type>ejb</type>  
    </dependency>
  </dependencies>

  <build>
    <finalName>regweb</finalName>

    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-ear-plugin</artifactId>
        <version>2.4.1</version>
        <configuration>
          <displayName>Registre Web</displayName>
          <description>Registre Web</description>
          <jboss>
            <version>3.2</version>
            <loader-repository>es.caib.regweb:loader=regweb.ear</loader-repository>
            <loader-repository-config>java2ParentDelegation=false</loader-repository-config>
          </jboss>
          <modules>
            <webModule>
              <groupId>es.caib.regweb</groupId>
              <artifactId>webapp</artifactId>              
              <contextRoot>regweb</contextRoot>
              <bundleFileName>regweb.war</bundleFileName>
            </webModule>
            <ejbModule>
              <groupId>es.caib.regweb</groupId>
              <artifactId>ejb</artifactId>
              <bundleFileName>regweb.jar</bundleFileName>
            </ejbModule>
            <ejbModule>
              <groupId>es.caib.regweb</groupId>
              <artifactId>logic</artifactId>
              <bundleFileName>logic.jar</bundleFileName>
            </ejbModule>
            <jarModule>
              <groupId>es.caib.regweb</groupId>
              <artifactId>model</artifactId>
              <bundleFileName>model.jar</bundleFileName>
            </jarModule>
          </modules>
          <defaultLibBundleDir>lib</defaultLibBundleDir>
          <archive>
            <addMavenDescriptor>false</addMavenDescriptor>
          </archive>
        </configuration>
      </plugin>

      <plugin>
        <groupId>org.codehaus.cargo</groupId>
        <artifactId>cargo-maven2-plugin</artifactId>
        <version>1.0.6</version>
        <configuration>
            <wait>true</wait>            
            <container>
                <containerId>jboss3x</containerId>
                <zipUrlInstaller>
                    <url>http://sourceforge.net/projects/jboss/files/JBoss/JBoss-3.2.8.SP1/jboss-3.2.8.SP1.zip</url>
                    <!-- <url>file:///C:/J2EE/jboss-3.2.8.SP1.zip</url>-->
                    <installDir>${project.build.directory}</installDir>
                </zipUrlInstaller>
                <dependencies>
                    <dependency>
                        <groupId>postgresql</groupId>
                        <artifactId>postgresql</artifactId>
                    </dependency>
                </dependencies>
            </container>
            <configuration>
                <home>${project.build.directory}/jboss3x</home>
                <configfiles>
                   <configfile>
                     <file>${basedir}/src/test/resources/jboss3x/login-config.xml</file>
                     <todir>conf</todir>
                   </configfile>
                   <configfile>
                     <file>${basedir}/src/test/resources/jboss3x/seycon-roles.properties</file>
                     <todir>conf</todir>
                   </configfile>
                   <configfile>
                     <file>${basedir}/src/test/resources/jboss3x/seycon-users.properties</file>
                     <todir>conf</todir>
                   </configfile>
                   <configfile>
                     <file>${basedir}/src/test/resources/jboss3x/regweb-ds.xml</file>
                     <todir>deploy</todir>
                   </configfile>
                 </configfiles>
            </configuration>
        </configuration>
      </plugin>
    </plugins>
  </build>

</project>
